/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
"use strict";
$(document).ready(function() {
    function SetBodyFixed() {
        var scroll = $(window).scrollTop();
        var offset = $('body').hasClass('advertisement') ? 300 : 1;
        if (scroll >= offset) {
            $('body').addClass('fixed')
        } else {
            $('body').removeClass('fixed')
        }
    }
    $(window).on('load resize scroll', function() {
        SetBodyFixed()
    });
    $('.ad-close').click(function() {
        $.post("/disable-ad", function(data) {
            if (data === "success") {
                $('.ad-close').tooltip('hide');
                $('.ad-close').remove();
                $('.ad').remove();
                $('body').removeClass('advertisement').removeAttr("style");
                if ($('#geo-map').length >= 1) {
                    google.maps.event.trigger(map, "resize");
                    map.setCenter(Centre)
                }
            }
        })
    });
    $('.nav-toggle').click(function() {
        $('.nav-toggle').toggleClass('active');
        $('.navigation').toggleClass('active');
        $('body').toggleClass('noscroll');
        event.preventDefault()
    });
    $(".navigation").on('click', 'a', function() {
        var $tabValue = $(this).attr('href');
        var $withoutHash = $tabValue.substr(0, $tabValue.indexOf('#'));
        if ($withoutHash === window.location.pathname) {
            $('.nav-toggle').removeClass('active');
            $('.navigation').removeClass('active');
            $('body').removeClass('noscroll')
        }
    });
    if ($('.box').length >= 1) {
        $('.box').matchHeight()
    }
    $('#login').submit(function(e) {
        $.post("/login", $(this).serialize()).done(function(data) {
            data = jQuery.parseJSON(data);
            if (data.result === "granted") {
                window.location.href = "/" + data.language + "/administration"
            } else if (data.result === "inactive") {
                $('header .login-container').addClass('has-error');
                $('.attempts .text').html(data.text);
                if (!$('.attempts').is(":visible")) {
                    $('.attempts').slideDown()
                }
            } else if (data.result === "denied") {
                $('header .login-container').addClass('has-error');
                if (data.remaining <= 3) {
                    $('.attempts .text').html(data.text);
                    if (!$('.attempts').is(":visible")) {
                        $('.attempts').slideDown()
                    }
                    if (data.remaining === 0) {
                        $('.attempts').find($(".fa")).addClass('fa-ban').removeClass('fa-warning');
                        $('#login').slideUp(function() {
                            $('#login').remove()
                        })
                    }
                }
            }
        });
        e.preventDefault()
    });
    var jValNewsletter = {
        'NewsletterEmail': function() {
            var ele = $('#newsletter-email');
            var patt = /^.+@.+[.].{2,}$/i;
            if (!patt.test(ele.val())) {
                jValNewsletter.errors = !0;
                ele.addClass('error')
            } else {
                ele.removeClass('error')
            }
        },
        'sendIt': function() {
            if (!jValNewsletter.errors) {
                var dataString = $('#newsletter-form').serialize();
                $.ajax({
                    type: "POST",
                    url: "/newsletter",
                    data: dataString,
                    success: function(text) {
                        if (text === "subscribed") {
                            $('#newsletter-btn').fadeToggle(function() {
                                $('#result-btn').fadeToggle()
                            });
                            $('#newsletter-email').fadeToggle(function() {
                                $('#result-subscription').fadeToggle()
                            })
                        } else {
                            $('#newsletter-email').addClass('error')
                        }
                    }
                })
            }
        }
    };
    $('#newsletter-email').keypress(function(e) {
        if (e.which === 13) {
            $('#newsletter-form').submit();
            jValNewsletter.errors = !1;
            jValNewsletter.NewsletterEmail();
            jValNewsletter.sendIt();
            e.preventDefault();
            return !1
        }
    });
    $('#newsletter-email').change(jValNewsletter.NewsletterEmail);
    $('#newsletter-form').submit(function() {
        return !1
    });
    $('#newsletter-btn').click(function() {
        jValNewsletter.errors = !1;
        jValNewsletter.NewsletterEmail();
        jValNewsletter.sendIt()
    });
    $('#result-btn').click(function() {
        $('#result-btn').fadeToggle(function() {
            $('#newsletter-btn').fadeToggle()
        });
        $('#result-subscription').fadeToggle(function() {
            $('#newsletter-form')[0].reset();
            $('#newsletter-email').removeClass('error').fadeToggle()
        })
    });
    $('body').tooltip({
        selector: '[data-toggle="tooltip"]'
    });
    $("a[href^=http], a[href^=https]").click(function() {
        if (this.href.indexOf(location.hostname) === -1) {
            $(this).attr({
                target: "_blank"
            })
        }
    });
    if ($('#back-to-top').length) {
        var scrollTrigger = 100
          , backToTop = function() {
            var scrollTop = $(window).scrollTop();
            if (scrollTop > scrollTrigger) {
                $('#back-to-top').addClass('is-visible')
            } else {
                $('#back-to-top').removeClass('is-visible')
            }
        };
        backToTop();
        $(window).on('scroll', function() {
            backToTop()
        });
        $('#back-to-top').on('click', function(e) {
            e.preventDefault();
            if ($('html').hasClass('fp-enabled')) {
                $.fn.fullpage.moveTo(1)
            } else {
                $('html,body').animate({
                    scrollTop: 0
                }, 700, 'easeInOutCubic')
            }
        })
    }
})


